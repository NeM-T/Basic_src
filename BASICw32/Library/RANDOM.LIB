! 各種乱数

EXTERNAL FUNCTION RNDNormal(m,s) 
REM 正規分布N(m,s^2)に従う乱数
REM 平均m，分散s^2 の正規分布
DECLARE EXTERNAL FUNCTION Box_Muller.Normal
LET RNDNormal=m+s*Box_Muller.Normal
END FUNCTION

EXTERNAL FUNCTION RNDBinom(n,p)
REM 二項分布B(n,p)に従う乱数 (binomial distribution)
DECLARE NUMERIC c,k
LET c=0
FOR k=1 TO n
   IF RND<p THEN LET c=c+1
NEXT k
LET RNDBinom=c
END FUNCTION

EXTERNAL FUNCTION RNDPoisson(m)
REM ポアソン分布に従う乱数（平均m）(Poisson distribution)
DECLARE NUMERIC s,t,p,k
LET p=RND
LET t=EXP(-m)
LET s=t
LET k=0
DO WHILE s<p
   LET k=k+1
   LET t=t*m/k
   LET s=s+t 
LOOP
LET RNDPoisson=k
END FUNCTION
 
EXTERNAL FUNCTION RNDHyperGeom(N,d,m)
REM 超幾何分布に従う乱数
REM N個中d個が当たりであるとき，m個非復元抽出するときの当たりの個数
DECLARE NUMERIC i,k
LET k=0
FOR i=1 TO m
   IF RND*N<d THEN  ! 当たり
      LET k=k+1
      LET d=d-1
   END IF
   LET N=N-1
NEXT i
LET RNDHyperGeom=k
END FUNCTION

EXTERNAL  FUNCTION RNDPascal(k,p)
REM 負の2項分布(パスカル分布)
REM 確率pの独立試行がk回成功するまでの失敗の回数
DECLARE NUMERIC x,i
LET i=0 ! 成功回数
LET x=0 ! 失敗回数
DO UNTIL i=k
   IF RND<p THEN  !成功
      LET i=i+1
   ELSE 
      LET x=x+1
   END IF
LOOP     
LET RNDPascal=x
END FUNCTION

EXTERNAL FUNCTION RNDchi2(n)
REM χ2乗分布 カイ2乗分布に従う乱数 (chi-square distribution)  
DECLARE EXTERNAL FUNCTION Box_Muller.Normal
DECLARE NUMERIC i,t
LET t=0
FOR i = 1 TO n
   LET t=t+Normal^2
NEXT i
LET RNDchi2=t
END FUNCTION

EXTERNAL FUNCTION RNDt(n)
REM t分布t(n)に従う乱数
DECLARE EXTERNAL FUNCTION Box_Muller.Normal,RNDchi2
LET RNDt=Normal/SQR(RNDchi2(n)/n)
END FUNCTION

EXTERNAL FUNCTION RNDGeom(p)
REM 幾何分布に従う乱数 (geometric distribution)
LET RNDGeom=CEIL(LOG(1-RND)/(LOG(1-p)))
END FUNCTION

EXTERNAL FUNCTION RNDEXP(a)
REM 指数分布EXP(a)に従う乱数 (exponential distribution)
LET RNDEXP=-1/a*LOG(1-RND)
END FUNCTION
 
MODULE Box_Muller
REM Box-Muller法による標準正規乱数
PUBLIC FUNCTION Normal 
SHARE NUMERIC r,t,s
LET s=0
EXTERNAL FUNCTION Normal
   IF s=0 THEN
      LET r=SQR(-2*LOG(1-RND))
      LET t=2*PI*RND
      LET Normal=r*COS(t)
      LET s=1
   ELSE
      LET Normal=r*SIN(t)
      LET s=0
   END IF
END FUNCTION
END MODULE


